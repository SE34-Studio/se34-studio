> Author : CG
>

## 应用层概念和作用
应用层是OSI模型的第7层，位于用户和网络之间。

它提供用户界面和通信服务，如网页浏览、邮件收发、文件下载、视频播放等。典型协议包括：HTTP、FTP、SMTP、POP3、IMAP、DNS、BitTorrent、SSH 等。

---

## DNS
### DNS的定义
**DNS** 的全称是 **Domain Name System（域名系统）**，是互联网的核心基础服务之一。

一个简单的例子，DNS 是一个用于将域名（如 www.baidu.com）转换为 IP 地址（如 192.0.2.1）的分布式数据库系统。因为人类容易记住“域名”而不是复杂的 IP 地址（数字），所以我们访问网站时使用域名，背后是 DNS 在帮我们做“翻译”。

---

### DNS的作用和特点
1. 域名解析:把人类可读的域名翻译成计算机可读的 IP 地址。

2. 邮件路由支持:支持邮件服务器定位（通过 MX 记录）。

3. 服务发现:支持通过 DNS 发现服务（例如通过 SRV 记录定位 SIP、XMPP 服务等）。

4. 负载均衡:通过 DNS 轮询可以实现简单的负载均衡。

5. 分布式和可扩展性强:它是分层的、全球分布式的，支持大规模互联网访问。

---

### DNS的工作原理（域名解析的过程）
DNS 是**分层查询系统**，采用**递归**和**迭代查询**两种方式。以访问 `www.example.com` 为例：

首先，用户输入域名，例如在浏览器中输入：`www.example.com`

查询过程如下：

1. **本地 DNS 缓存**：先查本地（操作系统）是否缓存了这个域名的 IP 地址。
2. **向本地 DNS 服务器查询（递归查询）**：
    - 如果没有缓存，就发请求到配置好的 DNS 服务器（通常由 ISP 提供）。
    - 本地 DNS 会代替用户去查找完整路径，直到获取结果。
3. **根域名服务器（Root DNS）**：
    - 根服务器告诉本地 DNS：“`.com` 顶级域的服务器在哪里。”
    - 世界上有 13 个主根服务器，分布在全球（镜像很多）。
4. **顶级域名服务器（TLD DNS）**：
    - `.com` 的服务器会告诉本地 DNS：“example.com 的权威服务器在哪。”
5. **权威 DNS 服务器（Authoritative DNS）**：
    - 最后，example.com 的权威服务器告诉本地 DNS：  
`www.example.com` 对应的 IP 地址是 `192.0.2.1`
6. **返回给用户并缓存**：
    - 本地 DNS 把结果返回给用户的设备，并缓存一段时间以供下次查询更快。
    - 浏览器连接目标 IP 地址，开始加载网页。

---

### 域名的基本结构和合法规则
域名由多个标签组成，标签之间用“点号.”隔开，`www.example.com.`从右往左其中：

+ com. 是顶级域名（TLD）
+ example 是二级域名
+ www 是三级域名

域名系统其实是倒树结构，从根域（.）开始。以下是一些合法域名的命名规则：

字符：只能使用英文字母（a-z）、数字（0-9）、连字符（-）

开头结尾：不能以连字符开头或结尾

长度：单个标签 ≤ 63 字符，总长度 ≤ 253 字符

大小写：不区分大小写（ABC.com = abc.com）

保留字：一些特殊域名保留用于局部用途，如 localhost、.test、.example

---

### 顶级域名
顶级域名由ICANN管理，也就是互联网名称和数字地址分配机构

![](https://cdn.nlark.com/yuque/0/2025/png/43076700/1748251781140-d1039437-bf42-4f80-8512-eebec1a3dc62.png)

---

## HTTP、HTTPS相关
### HTTP 与 HTTPS 的定义与区别
#### 什么是 HTTP？
HTTP 全称是 HyperText Transfer Protocol（超文本传输协议），是 Web 上最基本的数据通信协议。

HTTP 是一个客户端-服务器模型的应用层协议，通常运行在 TCP 协议之上，使用端口号 **80**。

它用于浏览器与服务器之间的数据通信，例如加载网页、提交表单等。

#### 什么是HTTPS？
HTTPS（HTTP Secure）是加密版的 HTTP，多带一个S代表Secure。

HTTPS = HTTP + SSL/TLS 安全层，通常使用端口 443。

它通过 SSL/TLS 协议对 HTTP 数据进行加密、认证和完整性保护。

#### 二者有什么区别？
| 项目 | HTTP | HTTPS |
| :---: | :---: | :---: |
| 加密 | 明文传输，容易被窃听 | 加密传输（TLS/SSL） |
| 安全性 | 无身份验证、数据容易被篡改 | 支持身份验证、防止中间人攻击 |
| 默认端口 | 80 | 443 |
| 证书 | 无需证书 | 需要数字证书（CA签发） |
| 性能 | 稍快（无加密） | 稍慢（TLS握手耗时），但可用 HTTP/2 弥补 |


---

### HTTP的无状态含义
首先，什么是无状态？无状态指：HTTP 协议不保留客户端的状态信息，每次请求都是独立的，服务器不会自动记住之前发生了什么。

这意味着第一次访问和第二次访问之间是“没有记忆”的，因此需要额外机制来“保持会话” —— 比如 Cookie、Session、Token。

---

### Cookie
**Cookie** 是由服务器发送到客户端的一段小数据，存储在浏览器本地，并会在之后的每次请求中自动带上。

Cookie 的作用如下：

+ 实现用户登录状态保持（记住你是谁）
+ 跟踪用户行为（如广告追踪）
+ 保存用户设置（如语言、主题等）

工作流程是：

+ 用户第一次访问网站时，服务器返回一个响应并且设置Cookie，可能携带id、Path、HttpOnly等信息
+ 用户下一次请求的时候，浏览器会自动带上这个信息
+ 服务器会根据Cookie内容识别用户，实现状态记忆的模拟

使用HTTPS的一大优点就是可以防止Cookie被窃取，例如中间人的攻击或者窃听。另外，还可以设置Secure标签，表示只在HTTPS下传输该Cookie。

---

### HTTP 的连接方式
HTTP 使用 TCP 连接，但并不总是使用“长连接”。

#### 非持续连接（短连接）
每一次 HTTP 请求都建立一次 TCP 连接，请求完即断开。

优点：简单，资源释放快

缺点：频繁建立/关闭连接，开销大，效率低

#### 持续连接（长连接，Keep-Alive）
多个 HTTP 请求复用同一个 TCP 连接，从 HTTP/1.1 开始默认启用。HTTPS也支持长连接。

通过设置头部：`Connection: keep-alive`

持续连接的优势有，避免频繁 TCP 握手、挥手，并且明显减少延迟（尤其是页面中有很多资源如图片、JS、CSS），提高性能

但服务器仍可以设置 Keep-Alive 超时时间，超过就断。在 HTTP/2 中，持续连接机制更进一步（多路复用）

---

## 应用层常用命令
### 1. ping
作用：用于测试本机与目标主机之间是否可达，以及往返时延。

常用语法：`ping 8.8.8.8``ping www.baidu.com`

原理：

+ 使用 ICMP 协议发送回显请求（Echo Request）
+ 接收回显响应（Echo Reply）

用途：

+ 测试目标主机是否在线
+ 测试 DNS 是否能解析
+ 测试网络连通性和丢包情况

### 2. tracert（Windows） / traceroute（Linux）
作用：显示数据包从本机到目标主机所经过的每一跳路由（即路径）。

常用语法：`tracert www.google.com`

原理：

+ 利用 ICMP 和 IP 的 TTL（生存时间）字段
+ 每次 TTL 加一，直到到达目标主机
+ 每一跳返回一个“超时”或“回应”，构成路径

用途：

+ 分析网络路径
+ 判断卡在哪一跳
+ 检查网络瓶颈或中断位置

### 3. nslookup
作用：查询 DNS 记录（如 A 记录、MX、CNAME 等），判断 DNS 是否正常解析域名。

常用语法：`nslookup www.baidu.com`

用途：

+ 验证域名解析情况
+ 排查 DNS 是否正常
+ 查询域名服务器的 IP 地址

### 4. ipconfig（Windows） / ifconfig（Linux）
作用：查看和管理本机的网络接口配置信息。

常用语法：`ipconfig /all`

用途：

+ 查看 IP、子网掩码、网关、DNS、MAC 地址
+ 更新 IP 地址：ipconfig /release + ipconfig /renew
+ 刷新 DNS 缓存：ipconfig /flushdns

### 5. arp -a
作用：显示 ARP（地址解析协议）缓存表，用于查看本机已解析的 IP 与 MAC 的映射关系。

原理：

+ ARP 将 IP 地址解析为 MAC 地址（在同一局域网中）
+ 缓存结果保存在 ARP 表中

用途：

+ 检查本地 ARP 缓存
+ 判断是否存在 ARP 欺骗
+ 查看本机通信过的设备的 MAC 地址

---

### Ping之后，网络层以下发生了什么？
`ping` 使用的是 ICMP 协议，它工作在 网络层（OSI 第三层），但整个过程涉及从第七层到第一层的完整路径。

1. 应用层（第 7 层）：用户输入 ping www.baidu.com，这是人类可读的操作。

2. 表示层 + 会话层（第 6-5 层）：这两层在 ping 中基本透明，主要在复杂数据通信（如加密、压缩）中起作用。

3. 传输层（第 4 层）：跳过！ ICMP 不属于 TCP 或 UDP，因此不会经过传输层。直接走网络层。

4. 网络层（第 3 层）：此处发生关键步骤，

+ 使用 ICMP 协议 构造 Echo Request 报文
+ 将目标主机域名通过 DNS 解析 成 IP 地址
+ 构造 IP 数据包，设置 TTL 等信息
+ 路由选择，确定下一跳

5. 数据链路层（第 2 层）：这里发生的是，

+ 使用 ARP 协议查找目标 IP 的 MAC 地址
+ 构造以太网帧（Ethernet Frame），包括：源 MAC、目标 MAC、上层协议标志（IPv4）
+ 加上帧头和帧尾，准备传输

6. 物理层（第 1 层）：最终，将帧转换为电信号或光信号（取决于媒介），并通过网线或无线信号传输到下一跳（交换机、路由器）

---

## 应用层协议
### 文件传输协议
| 协议 | 功能 | 传输方式 |
| :---: | :---: | :---: |
| **FTP** | File Transfer Protocol | 客户端-服务器，使用 TCP（21 控制 + 20 数据） |
| **SFTP** | SSH File Transfer Protocol | 加密的文件传输 |
| **HTTP/HTTPS** | 下载网页、图片、文件 | 面向对象、基于请求响应 |
| **P2P（Peer to Peer）** | 点对点文件共享（如BT下载） | 节点互为客户端和服务器 |




#### 什么是 P2P 文件传输？
P2P = Peer-to-Peer（点对点），是一种去中心化的文件传输方式。

特点：

+ 每个节点既是客户端也是服务器（peer）
+ 没有单一服务器，资源从多个节点汇聚而来
+ 典型应用：BitTorrent（BT）、eMule、电驴

优点：

+ 减轻服务器压力
+ 下载速度快（可并行从多个 peer 获取数据）
+ 抗故障性强（节点掉线不会影响整体）

缺点：

+ 法律风险（版权问题）
+ 网络波动大，不适合低延迟服务（如视频会议）

---

### 电子邮件协议
电子邮件系统主要分为两个阶段：

| 阶段 | 说明 | 使用协议 |
| :---: | :---: | :---: |
| **发送邮件** | 从发件人客户端 → 发件人邮件服务器 → 收件人邮件服务器 | **SMTP（Simple Mail Transfer Protocol）** |
| **接收邮件** | 收件人客户端 → 收件人邮件服务器（下载或查看邮件） | **POP3** 或 **IMAP** |




#### 1. SMTP（Simple Mail Transfer Protocol）
功能：发送邮件（client → server / server → server）

端口号：25（明文），465（SSL），587（TLS）

单向协议：不能接收邮件

#### 2. POP3（Post Office Protocol v3）
功能：接收邮件（下载到本地，读取后通常会从服务器删除）

端口号：110（明文），995（SSL）

使用场景：离线阅读，适用于只用一个客户端

#### 3. IMAP（Internet Message Access Protocol）
功能：接收邮件（同步邮件，保留在服务器，可多设备共享）

端口号：143（明文），993（SSL）

支持服务器端文件夹、标签、邮件状态

---

总结来说，SMTP负责发，POP3和IMAP负责收，POP3读完了删，IMAP能保留。且IMAP对多设备的支持好，也支持同步，这些都是POP3做不到的，POP3唯一的优点就是简单。

---

### 内容分发网络（CDN）
CDN（Content Delivery Network）内容分发网络是由分布在全球的缓存节点组成的网络系统，目的是就近向用户提供内容，提高访问速度，减轻源服务器压力。

工作原理是，例如用户访问一个视频的链接，CDN通过DNS或者其他调度系统把用户请求导向最近的CDN节点，节点查找本地是否缓存了该资源。如果有，直接返回，如果没有，回源服务器请求内容，缓存后返回给用户。最后用户获得内容，整体的体验速度比较快。

对于视频访问量很大这个例子，CDN的作用是：如果全部请求都打到源服务器，服务器会崩溃。使用 CDN后，请求被分散到各地的 CDN 节点，同一视频只需要从源服务器下载一次，之后就缓存下来。后续用户访问的是就近 CDN 节点，大幅减轻源站压力。

概括来说是：

+ **提高访问速度（延迟低）**
+ **提高并发能力**
+ **降低带宽成本**
+ **避免单点故障**

一些典型的应用场景包括视频点播和视频网站，静态网站资源，游戏更新，软件分发镜像，静态资源缓存。

---

### 协议整理
| **协议/系统** | **类型** | **功能** | **端口** | **方向** |
| :---: | :---: | :---: | :---: | :---: |
| **SMTP** | **邮件协议** | **发送邮件** | **25/465/587** | **发** |
| **POP3** | **邮件协议** | **下载邮件** | **110/995** | **收** |
| **IMAP** | **邮件协议** | **同步邮件** | **143/993** | **收** |
| **FTP** | **文件传输** | **上传/下载** | **21/20** | **双向** |
| **P2P** | **文件传输** | **多点下载** | **动态** | **双向** |
| **CDN** | **网络架构** | **内容缓存加速** | **通常基于 HTTP/HTTPS** | **分发** |


