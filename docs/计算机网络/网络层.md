> Author : CG、WZF 
>

## 基本功能与作用
网络层是OSI七层模型的第三层，其核心功能是：

**路由选择**（Routing）：为数据包选择一条从源主机到目的主机的最优路径。路由器通过动态或静态的路由协议决定转发方向。

**逻辑寻址**（Logical Addressing）：为每个网络设备分配唯一的地址（如IP地址），实现跨网络的通信。负责IP地址的分配与解析。

**分段与重组**（Fragmentation & Reassembly）：由于底层链路的MTU（最大传输单元）限制，网络层将大数据包拆分成多个小片（分片）。接收端负责重组这些数据片还原为完整包。

**转发与中继**（Forwarding）：网络层设备（如路由器）根据目的地址选择下一跳，执行数据包的转发。

**差错处理与控制**（Error Handling & Control）（非主要功能）：网络层通常不保证可靠传输，但某些协议会提供路径失效通知。

---

## 主要协议
### IP协议（Internet Protocol）
IP协议是网络层的核心协议，面向无连接，尽力而为（best-effort）。同时支持IPv4和IPv6。

主要功能有：

+ 提供逻辑地址（IP地址）；
+ 数据包的封装、转发和分片；
+ 不保证可靠性，不提供重传；

IP协议的体现方式是，每个IP包头中包含源IP、目的IP、TTL、分片信息等字段；路由器根据目的IP查找转发表，决定下一跳。

---

### ICMP协议（Internet Control Message Protocol）
ICMP协议，用于传输控制消息，如错误报告、网络状态检测；它不传输数据，仅用于网络维护和诊断；

常见用途有，ping 命令使用ICMP Echo请求/应答；通知目标不可达、TTL超时、重定向等；

ICMP协议的体现方式是，ICMP消息封装在IP包中，作为IP负载；路由器或主机在出错时发出ICMP报文。

---

### ARP协议（Address Resolution Protocol）
ARP协议严格地说属于数据链路层与网络层之间的接口，主要功能是将IP地址解析为MAC地址；在局域网中实现从逻辑地址到物理地址的映射；

体现方式是主机广播ARP请求，目标主机回复ARP应答；每个主机会维护一个ARP缓存表；

ARP协议有一个常见攻击考点——ARP欺骗，可导致中间人攻击（MITM）。

---

### 路由协议（Routing Protocols）
这里提到的路由协议虽然工作在网络层，但它们是供路由器之间使用，决定如何建立路由表。

**RIP（Routing Information Protocol）**

基于距离向量算法，度量单位是跳数；最多支持15跳；简单但收敛慢，适用于小型网络。

**OSPF（Open Shortest Path First）**

基于链路状态协议，使用Dijkstra算法；支持大规模网络；更快收敛，支持区域划分。

**BGP（Border Gateway Protocol）**

用于不同自治系统（AS）之间；是互联网核心路由协议；保证互联网的全球可达性。

---

## IP地址和子网划分
**IP地址（Internet Protocol Address）**是用于唯一标识网络中每一台主机的地址。

IPv4其实就代表了第四个版本，v就是version。IPv4地址是32位的二进制数，通常用 点分十进制 表示，有如下的地址格式：`192.168.1.1`

每一段是一个 8位二进制数（0-255）。

IPv4地址分为两部分：网络号（Network ID）和主机号（Host ID）

---

### 子网掩码（Subnet Mask）
子网掩码用于将IP地址划分为网络部分和主机部分。

例如：IP地址：`192.168.1.1`对应的子网掩码为`255.255.255.0`（即 24 位）

网络部分是前24位，主机部分是后8位。

子网掩码有一个CIDR表示法（无类域间路由），全称是CIDR（Classless Inter-Domain Routing），用“斜杠+位数”表示子网掩码。

例如：`192.168.1.0/24` 等价于子网掩码 `255.255.255.0`

**子网划分的好处**

+ 提高地址利用率：避免浪费IP地址资源。
+ 增强网络安全性：子网之间可用防火墙隔离。
+ 提升管理效率：便于网络管理和故障排查。
+ 控制广播域：减小广播风暴，提高网络性能。

**子网划分的过程**

1. **确定需求：**有多少个子网？每个子网需要多少主机？
2. **使用公式计算所需位数：**
    - 子网数所需位数：2^n >= 子网数
    - 每个子网主机数所需位数：2^m - 2 >= 主机数（减2是因为去掉网络地址和广播地址）
3. **生成子网掩码**：原始掩码 + 所用子网位数 = 新子网掩码
4. **列出子网划分结果**：网络地址、子网掩码、主机IP范围、广播地址、默认网关（通常是主机范围内的第一个或最后一个地址）

**子网划分例子**

我们从一个典型的场景开始：假设你拥有一个网络地址为 192.168.10.0/24 的私有IP段，你的任务是将其划分成至少6个子网，并列出每个子网的网络地址、广播地址、可用主机范围以及子网掩码。为了完成这个任务，首先我们需要确定每个子网至少能容纳多少主机。尽管题目没要求每个子网的主机数量，但我们必须按照能划分出“至少6个子网”为前提，来计算合适的子网位数。

因为原始网络是 /24，也就是有8个（32-24）位用于主机编号（2⁸ = 256个地址，其中去除网络地址和广播地址，可用254个）。要从中划分出至少6个子网，我们需要“借”主机位来做子网位。我们通过计算，2ⁿ ≥ 6 得到 n=3（即借3个位可以生成2³=8个子网，满足要求）。于是，新的子网掩码就是 /24 + 3 = /27。换句话说，我们把原来的256个IP地址段平均分成了8个子网，每个子网大小为 2⁵ = 32 个地址（其中30个可用主机地址）。

接下来我们列出所有8个子网的信息。因为每个子网块有32个地址，它们的网络地址将依次是：

第一个子网：192.168.10.0/27

网络地址是192.168.10.0，广播地址是192.168.10.31，可用主机从192.168.10.1到192.168.10.30。

第二个子网：192.168.10.32/27

网络地址是192.168.10.32，广播地址是192.168.10.63，可用主机从192.168.10.33到192.168.10.62。

第三个子网：192.168.10.64/27

网络地址是192.168.10.64，广播地址是192.168.10.95，可用主机从192.168.10.65到192.168.10.94。

第四个子网：192.168.10.96/27

网络地址是192.168.10.96，广播地址是192.168.10.127，可用主机从192.168.10.97到192.168.10.126。

第五个子网：192.168.10.128/27

网络地址是192.168.10.128，广播地址是192.168.10.159，可用主机从192.168.10.129到192.168.10.158。

第六个子网：192.168.10.160/27

网络地址是192.168.10.160，广播地址是192.168.10.191，可用主机从192.168.10.161到192.
